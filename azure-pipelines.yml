trigger: 
 branches:
   include:
     - develop
pool: 
 name: Jagseer-pc

stages:
  - stage: Linter_and_scanners
    displayName: React coce linter and scanner
    jobs:
      - job: Biome_lint
        displayName: Lint Javascript(biome)
        steps :
        - task: PowerShell@2
          continueOnError: true
          inputs:
            targetType: 'inline'
            script: |
              Invoke-WebRequest -Uri "https://github.com/biomejs/biome/releases/download/%40biomejs%2Fbiome%402.3.8/biome-win32-x64.exe" -OutFile "$(Agent.ToolsDirectory)/biome.exe"
              $(Agent.ToolsDirectory)/biome.exe lint "$(System.DefaultWorkingDirectory)/src/"
  - stage: SoftwareCompositionAnalysis
    displayName: Software Composition Analysis (Dependency security)
    jobs:
      - job: Dependencyvulnerabilityscan
        displayName: Dependencies Vulnerability Scan(Retire.js)
        steps:
        - task: PowerShell@2
          inputs:
            targetType: 'inline'
            script: |
              npm install -g retire
              npm install
              retire --exitwith 0

  - stage: StaticCodeAnalysis
    displayName: SCA Sonarqube
    jobs:
      - job: StaticCode_Analysis
        displayName: Static code Analysis Sonarqube
        steps:
        - task: SonarQubePrepare@8
          inputs:
            SonarQube: 'sonarqube-local'
            scannerMode: 'cli'
            cliScannerVersion: '4.11.x'
            configMode: 'manual'
            cliProjectKey: 'Todo_app'
            cliProjectName: 'Todo_app'
            cliSources: 'src'

        - task: SonarQubeAnalyze@8
          inputs:
            jdkversion: 'JAVA_HOME_17_X64'    
        - task: SonarQubePublish@8
          inputs:
            pollingTimeoutSec: '300'

